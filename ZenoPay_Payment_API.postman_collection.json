{
	"info": {
		"_postman_id": "zenopay-payment-api",
		"name": "ZenoPay Payment Gateway API",
		"description": "Complete API collection for testing ZenoPay Mobile Money Tanzania integration with Mifumo WMS billing system. Includes user-friendly progress tracking and real-time payment status updates.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Login",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user@example.com\",\n    \"password\": \"your_password\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login",
								""
							]
						},
						"description": "Login to get JWT token for API authentication"
					},
					"response": []
				}
			]
		},
		{
			"name": "SMS Packages",
			"item": [
				{
					"name": "Get SMS Packages",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/sms/packages/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"sms",
								"packages",
								""
							]
						},
						"description": "Get available SMS packages for purchase"
					},
					"response": []
				}
			]
		},
		{
			"name": "SMS Balance",
			"item": [
				{
					"name": "Get SMS Balance",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/sms/balance/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"sms",
								"balance",
								""
							]
						},
						"description": "Get current SMS credit balance for tenant"
					},
					"response": []
				}
			]
		},
		{
			"name": "ZenoPay Payment Gateway",
			"item": [
				{
					"name": "Initiate Payment",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"package_id\": \"{{package_id}}\",\n    \"buyer_email\": \"{{buyer_email}}\",\n    \"buyer_name\": \"{{buyer_name}}\",\n    \"buyer_phone\": \"{{buyer_phone}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/billing/payments/initiate/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"payments",
								"initiate",
								""
							]
						},
						"description": "Initiate payment with ZenoPay for SMS package purchase. This creates a payment transaction and calls ZenoPay API to start the payment process."
					},
					"response": [
						{
							"name": "Success Response",
							"originalRequest": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{jwt_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"package_id\": \"{{package_id}}\",\n    \"buyer_email\": \"{{buyer_email}}\",\n    \"buyer_name\": \"{{buyer_name}}\",\n    \"buyer_phone\": \"{{buyer_phone}}\"\n}"
								},
								"url": {
									"raw": "{{base_url}}/api/billing/payments/initiate/",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"billing",
										"payments",
										"initiate",
										""
									]
								}
							},
							"status": "Created",
							"code": 201,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"message\": \"Payment initiated successfully. Please complete payment on your mobile device.\",\n    \"data\": {\n        \"transaction_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n        \"order_id\": \"MIFUMO-20241201-ABC12345\",\n        \"zenopay_order_id\": \"3rer407fe-3ee8-4525-456f-ccb95de38250\",\n        \"invoice_number\": \"INV-20241201-ABC12345\",\n        \"amount\": 1000.00,\n        \"credits\": 100,\n        \"status\": \"pending\",\n        \"payment_instructions\": \"Request in progress. You will receive a callback shortly\",\n        \"progress\": {\n            \"step\": 1,\n            \"total_steps\": 4,\n            \"current_step\": \"Payment Initiated\",\n            \"next_step\": \"Complete Payment on Mobile\",\n            \"completed_steps\": [\"Payment Initiated\"],\n            \"remaining_steps\": [\"Complete Payment on Mobile\", \"Payment Verification\", \"Credits Added\"],\n            \"percentage\": 25,\n            \"status_color\": \"blue\",\n            \"status_icon\": \"clock\"\n        }\n    }\n}"
						}
					]
				},
				{
					"name": "Check Payment Status",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/payments/transactions/{{transaction_id}}/status/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"payments",
								"transactions",
								"{{transaction_id}}",
								"status",
								""
							]
						},
						"description": "Check the current status of a payment transaction. This calls ZenoPay API to get the latest payment status and updates the transaction accordingly."
					},
					"response": [
						{
							"name": "Success Response",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{jwt_token}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/billing/payments/transactions/{{transaction_id}}/status/",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"billing",
										"payments",
										"transactions",
										"{{transaction_id}}",
										"status",
										""
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"data\": {\n        \"transaction_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n        \"order_id\": \"MIFUMO-20241201-ABC12345\",\n        \"status\": \"completed\",\n        \"payment_status\": \"SUCCESS\",\n        \"amount\": 1000.00,\n        \"reference\": \"0936183435\",\n        \"progress\": {\n            \"step\": 4,\n            \"total_steps\": 4,\n            \"current_step\": \"Payment Completed\",\n            \"next_step\": null,\n            \"completed_steps\": [\"Payment Initiated\", \"Complete Payment on Mobile\", \"Payment Verification\", \"Credits Added\"],\n            \"remaining_steps\": [],\n            \"percentage\": 100,\n            \"status_color\": \"green\",\n            \"status_icon\": \"check\"\n        },\n        \"updated_at\": \"2024-12-01T10:30:00Z\"\n    }\n}"
						}
					]
				},
				{
					"name": "Get Payment Progress",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/payments/transactions/{{transaction_id}}/progress/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"payments",
								"transactions",
								"{{transaction_id}}",
								"progress",
								""
							]
						},
						"description": "Get detailed progress information for user-friendly display. This provides comprehensive progress tracking with visual indicators."
					},
					"response": [
						{
							"name": "Success Response",
							"originalRequest": {
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{jwt_token}}"
									}
								],
								"url": {
									"raw": "{{base_url}}/api/billing/payments/transactions/{{transaction_id}}/progress/",
									"host": [
										"{{base_url}}"
									],
									"path": [
										"api",
										"billing",
										"payments",
										"transactions",
										"{{transaction_id}}",
										"progress",
										""
									]
								}
							},
							"status": "OK",
							"code": 200,
							"_postman_previewlanguage": "json",
							"header": [
								{
									"key": "Content-Type",
									"value": "application/json"
								}
							],
							"cookie": [],
							"body": "{\n    \"success\": true,\n    \"data\": {\n        \"transaction_id\": \"123e4567-e89b-12d3-a456-426614174000\",\n        \"order_id\": \"MIFUMO-20241201-ABC12345\",\n        \"invoice_number\": \"INV-20241201-ABC12345\",\n        \"amount\": 1000.00,\n        \"currency\": \"TZS\",\n        \"status\": \"completed\",\n        \"payment_status\": \"SUCCESS\",\n        \"progress\": {\n            \"step\": 4,\n            \"total_steps\": 4,\n            \"current_step\": \"Payment Completed\",\n            \"next_step\": null,\n            \"completed_steps\": [\"Payment Initiated\", \"Complete Payment on Mobile\", \"Payment Verification\", \"Credits Added\"],\n            \"remaining_steps\": [],\n            \"percentage\": 100,\n            \"status_color\": \"green\",\n            \"status_icon\": \"check\"\n        },\n        \"purchase\": {\n            \"package_name\": \"Starter Pack\",\n            \"credits\": 100,\n            \"unit_price\": 10.00\n        },\n        \"created_at\": \"2024-12-01T10:00:00Z\",\n        \"updated_at\": \"2024-12-01T10:30:00Z\",\n        \"completed_at\": \"2024-12-01T10:30:00Z\"\n    }\n}"
						}
					]
				},
				{
					"name": "List Payment Transactions",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/payments/transactions/?page=1&page_size=20&status=completed",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"payments",
								"transactions",
								""
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "page_size",
									"value": "20"
								},
								{
									"key": "status",
									"value": "completed"
								}
							]
						},
						"description": "List all payment transactions for the authenticated tenant with optional filtering and pagination."
					},
					"response": []
				},
				{
					"name": "Get Payment Transaction Details",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/payments/transactions/{{transaction_id}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"payments",
								"transactions",
								"{{transaction_id}}",
								""
							]
						},
						"description": "Get detailed information about a specific payment transaction."
					},
					"response": []
				},
				{
					"name": "Payment Webhook (ZenoPay)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-api-key",
								"value": "{{zenopay_api_key}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"order_id\": \"3rer407fe-3ee8-4525-456f-ccb95de38250\",\n    \"payment_status\": \"COMPLETED\",\n    \"reference\": \"0936183435\",\n    \"metadata\": {\n        \"product\": \"SMS Credits\",\n        \"amount\": \"1000\"\n    }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/billing/payments/webhook/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"payments",
								"webhook",
								""
							]
						},
						"description": "Simulate ZenoPay webhook notification for testing purposes. This endpoint is called by ZenoPay when payment status changes."
					},
					"response": []
				}
			]
		},
		{
			"name": "Purchase History",
			"item": [
				{
					"name": "Get Purchase History",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/sms/purchases/history/?page=1&page_size=20&status=completed",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"sms",
								"purchases",
								"history",
								""
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "page_size",
									"value": "20"
								},
								{
									"key": "status",
									"value": "completed"
								}
							]
						},
						"description": "Get detailed purchase history with filtering options."
					},
					"response": []
				}
			]
		},
		{
			"name": "Usage Statistics",
			"item": [
				{
					"name": "Get Usage Statistics",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/sms/usage/statistics/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"sms",
								"usage",
								"statistics",
								""
							]
						},
						"description": "Get SMS usage statistics for billing and analytics."
					},
					"response": []
				}
			]
		},
		{
			"name": "Billing Overview",
			"item": [
				{
					"name": "Get Billing Overview",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{jwt_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/billing/overview/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"billing",
								"overview",
								""
							]
						},
						"description": "Get comprehensive billing overview including subscription, usage, and balance information."
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Auto-extract transaction_id from initiate payment response",
					"if (pm.response && pm.response.json() && pm.response.json().data && pm.response.json().data.transaction_id) {",
					"    pm.environment.set('transaction_id', pm.response.json().data.transaction_id);",
					"    console.log('Transaction ID set:', pm.response.json().data.transaction_id);",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Auto-extract JWT token from login response",
					"if (pm.response && pm.response.json() && pm.response.json().access) {",
					"    pm.environment.set('jwt_token', pm.response.json().access);",
					"    console.log('JWT token set');",
					"}",
					"",
					"// Auto-extract package_id from packages response",
					"if (pm.response && pm.response.json() && pm.response.json().results && pm.response.json().results.length > 0) {",
					"    pm.environment.set('package_id', pm.response.json().results[0].id);",
					"    console.log('Package ID set:', pm.response.json().results[0].id);",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "transaction_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "package_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "buyer_email",
			"value": "test@example.com",
			"type": "string"
		},
		{
			"key": "buyer_name",
			"value": "Test User",
			"type": "string"
		},
		{
			"key": "buyer_phone",
			"value": "0744963858",
			"type": "string"
		},
		{
			"key": "zenopay_api_key",
			"value": "your_zenopay_api_key_here",
			"type": "string"
		}
	]
}
