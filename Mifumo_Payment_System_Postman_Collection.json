{
  "info": {
    "name": "Mifumo Payment System - Complete Purchase Flow",
    "description": "Complete payment system testing with mobile money integration",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://127.0.0.1:8000",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "package_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "transaction_id",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Login - Get JWT Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@mifumo.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/login/",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "login", ""]
            }
          },
          "response": []
        },
        {
          "name": "Refresh JWT Token",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh\": \"{{refresh_token}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/auth/token/refresh/",
              "host": ["{{base_url}}"],
              "path": ["api", "auth", "token", "refresh", ""]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "SMS Packages",
      "item": [
        {
          "name": "Get All SMS Packages",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/billing/sms/packages/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "sms", "packages", ""]
            }
          },
          "response": []
        },
        {
          "name": "Get SMS Package by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/billing/sms/packages/{{package_id}}/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "sms", "packages", "{{package_id}}", ""]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Mobile Money Providers",
      "item": [
        {
          "name": "Get Mobile Money Providers",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/billing/payments/providers/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "providers", ""]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Payment Flow",
      "item": [
        {
          "name": "Initiate Payment - Lite Package",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"package_id\": \"{{package_id}}\",\n  \"buyer_email\": \"admin@mifumo.com\",\n  \"buyer_name\": \"Admin User\",\n  \"buyer_phone\": \"0744963858\",\n  \"mobile_money_provider\": \"vodacom\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/billing/payments/initiate/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "initiate", ""]
            }
          },
          "response": []
        },
        {
          "name": "Initiate Payment - Standard Package",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"package_id\": \"{{package_id}}\",\n  \"buyer_email\": \"admin@mifumo.com\",\n  \"buyer_name\": \"Admin User\",\n  \"buyer_phone\": \"0744963858\",\n  \"mobile_money_provider\": \"tigo\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/billing/payments/initiate/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "initiate", ""]
            }
          },
          "response": []
        },
        {
          "name": "Initiate Payment - Pro Package",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"package_id\": \"{{package_id}}\",\n  \"buyer_email\": \"admin@mifumo.com\",\n  \"buyer_name\": \"Admin User\",\n  \"buyer_phone\": \"0744963858\",\n  \"mobile_money_provider\": \"airtel\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/billing/payments/initiate/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "initiate", ""]
            }
          },
          "response": []
        },
        {
          "name": "Initiate Payment - Enterprise Package",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"package_id\": \"{{package_id}}\",\n  \"buyer_email\": \"admin@mifumo.com\",\n  \"buyer_name\": \"Admin User\",\n  \"buyer_phone\": \"0744963858\",\n  \"mobile_money_provider\": \"halotel\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/billing/payments/initiate/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "initiate", ""]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Payment Status",
      "item": [
        {
          "name": "Get Payment Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/billing/payments/transactions/{{transaction_id}}/status/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "transactions", "{{transaction_id}}", "status", ""]
            }
          },
          "response": []
        },
        {
          "name": "Get All Payment Transactions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/billing/payments/transactions/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "transactions", ""]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "SMS Balance",
      "item": [
        {
          "name": "Get SMS Balance",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/billing/sms/balance/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "sms", "balance", ""]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Webhook Testing",
      "item": [
        {
          "name": "Simulate ZenoPay Webhook - Success",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"order_id\": \"{{transaction_id}}\",\n  \"payment_status\": \"COMPLETED\",\n  \"reference\": \"REF123456789\",\n  \"transid\": \"TXN123456789\",\n  \"channel\": \"MPESA-TZ\",\n  \"msisdn\": \"255744963858\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/billing/payments/webhook/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "webhook", ""]
            }
          },
          "response": []
        },
        {
          "name": "Simulate ZenoPay Webhook - Failed",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"order_id\": \"{{transaction_id}}\",\n  \"payment_status\": \"FAILED\",\n  \"reference\": \"REF123456789\",\n  \"transid\": \"TXN123456789\",\n  \"channel\": \"MPESA-TZ\",\n  \"msisdn\": \"255744963858\",\n  \"error_message\": \"Insufficient funds\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/billing/payments/webhook/",
              "host": ["{{base_url}}"],
              "path": ["api", "billing", "payments", "webhook", ""]
            }
          },
          "response": []
        }
      ]
    }
  ]
}
